<div class="p-6">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-900">Gestión de Pedidos</h1>
  </div>

  <!-- Estado de Carga -->
  @if (isLoading()) {
    <div class="text-center p-12">
      <p class="text-lg text-gray-700">Cargando pedidos...</p>
    </div>
  }

  <!-- Estado de Error -->
  @if (error() && !isLoading()) {
    <div class="my-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg">
      <strong>Error:</strong> {{ error() }}
    </div>
  }

  <!-- Lista de Pedidos -->
  @if (!isLoading() && !error()) {
    <div class="space-y-6">
      @for (pedido of pedidos(); track pedido.pedidoId) {
        <div class="bg-white shadow-lg rounded-lg overflow-hidden">
          
          <!-- Encabezado del Pedido -->
          <div class="bg-gray-50 p-4 border-b border-gray-200 grid grid-cols-2 md:grid-cols-4 gap-4">
            <div>
              <dt class="text-xs font-medium text-gray-500 uppercase">Pedido ID</dt>
              <dd class="text-sm font-semibold text-gray-900">#{{ pedido.pedidoId }}</dd>
            </div>
            <div>
              <dt class="text-xs font-medium text-gray-500 uppercase">Fecha</dt>
              <dd class="text-sm text-gray-700">{{ pedido.fecha | date:'dd/MM/yyyy h:mm a' }}</dd>
            </div>
            <div>
              <dt class="text-xs font-medium text-gray-500 uppercase">Cliente</dt>
              <dd class="text-sm text-gray-700">ID Usuario: {{ pedido.usuarioId }}</dd> <!-- (Podrías añadir email/nombre si lo devuelves en el DTO) -->
            </div>
            <div>
              <dt class="text-xs font-medium text-gray-500 uppercase">Total</dt>
              <dd class="text-lg font-bold text-indigo-600">{{ pedido.total | currency:'S/ ' }}</dd>
            </div>
          </div>

          <!-- Detalles y Estados -->
          <div class="p-4 grid grid-cols-1 md:grid-cols-3 gap-6">
            
            <!-- Columna de Items -->
            <div class="md:col-span-1">
              <h4 class="text-md font-semibold text-gray-800 mb-2">Items del Pedido</h4>
              <ul class="divide-y divide-gray-200">
                @for (item of pedido.detalles; track item.detallePedidoId) {
                  <li class="py-2 flex justify-between items-center">
                    <div>
                      <p class="text-sm font-medium text-gray-900">{{ item.productoNombre }}</p>
                      <p class="text-sm text-gray-500">
                        {{ item.cantidad }} x {{ item.precioUnitario | currency:'S/ ' }}
                      </p>
                    </div>
                    <p class="text-sm font-semibold text-gray-800">
                      {{ (item.cantidad * item.precioUnitario) | currency:'S/ ' }}
                    </p>
                  </li>
                }
              </ul>
            </div>
            
            <!-- Columna de Dirección -->
            <div class="md:col-span-1">
              <h4 class="text-md font-semibold text-gray-800 mb-2">Envío</h4>
              <address class="not-italic text-sm text-gray-600">
                {{ pedido.direccionEnvio }}
              </address>
            </div>

            <!-- Columna de Estados (Selects) -->
            <div class="md:col-span-1 space-y-4">
              
              <!-- Estado General -->
              <div>
                <label for="estado-pedido-{{pedido.pedidoId}}" class="block text-sm font-medium text-gray-700">Estado Pedido</label>
                <select 
                  id="estado-pedido-{{pedido.pedidoId}}" 
                  [ngModel]="pedido.estado"
                  (change)="onEstadoPedidoChange(pedido.pedidoId, $event)"
                  [disabled]="updatingStatus()[pedido.pedidoId + '-pedido']"
                  class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                  [ngClass]="getStatusColor(pedido.estado)">
                  @for (estado of estadosPedidoList; track estado) {
                    <option [value]="estado">{{ estado }}</option>
                  }
                </select>
              </div>

              <!-- Estado Pago -->
              <div>
                <label for="estado-pago-{{pedido.pedidoId}}" class="block text-sm font-medium text-gray-700">Estado Pago</label>
                <select 
                  id="estado-pago-{{pedido.pedidoId}}"
                  [ngModel]="pedido.estadoPago"
                  (change)="onEstadoPagoChange(pedido.pedidoId, $event)"
                  [disabled]="updatingStatus()[pedido.pedidoId + '-pago']"
                  class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                  [ngClass]="getStatusColor(pedido.estadoPago)">
                  @for (estado of estadosPagoList; track estado) {
                    <option [value]="estado">{{ estado }}</option>
                  }
                </select>
              </div>

              <!-- Estado Envío -->
              <div>
                <label for="estado-envio-{{pedido.pedidoId}}" class="block text-sm font-medium text-gray-700">Estado Envío</label>
                <select 
                  id="estado-envio-{{pedido.pedidoId}}"
                  [ngModel]="pedido.estadoEnvio"
                  (change)="onEstadoEnvioChange(pedido.pedidoId, $event)"
                  [disabled]="updatingStatus()[pedido.pedidoId + '-envio']"
                  class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                  [ngClass]="getStatusColor(pedido.estadoEnvio)">
                  @for (estado of estadosEnvioList; track estado) {
                    <option [value]="estado">{{ estado }}</option>
                  }
                </select>
              </div>
            </div> <!-- Fin Columna Estados -->

          </div>
        </div>
      } @empty {
        <div class="text-center p-12 bg-white rounded-lg shadow">
          <p class="text-lg text-gray-500">No se han encontrado pedidos.</p>
        </div>
      }
    </div>
  }
</div>
