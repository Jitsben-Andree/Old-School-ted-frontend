<div class="w-full animate-fade-in-up">
  
  <!-- Cabecera -->
  <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4">
    <div>
      <h1 class="text-2xl font-black text-[#151528] tracking-tight uppercase">
        Gestión de Pedidos
      </h1>
      <p class="text-sm text-gray-500 font-medium mt-1">
        Administra el flujo de ventas, pagos y envíos.
      </p>
    </div>
    
    <!-- Filtros o Acciones Globales (Opcional para futuro) -->
    <div class="flex gap-3">
       <div class="bg-white border border-gray-200 rounded-lg px-3 py-1.5 flex items-center shadow-sm">
          <span class="text-[10px] font-bold text-gray-400 uppercase mr-2">Total Pedidos:</span>
          <span class="text-sm font-black text-[#151528]">{{ pedidos().length }}</span>
       </div>
    </div>
  </div>

  <!-- Estado de Carga -->
  @if (isLoading()) {
    <div class="flex flex-col items-center justify-center py-20">
      <div class="w-12 h-12 border-4 border-gray-200 border-t-[#151528] rounded-full animate-spin mb-4"></div>
      <p class="text-xs font-bold text-gray-400 uppercase tracking-widest">Cargando pedidos...</p>
    </div>
  }

  <!-- Estado de Error -->
  @if (error() && !isLoading()) {
    <div class="mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-r-lg flex items-center gap-3 shadow-sm">
       <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
       <div>
          <h3 class="text-sm font-bold text-red-800">Error de carga</h3>
          <p class="text-sm text-red-600">{{ error() }}</p>
       </div>
    </div>
  }

  <!-- Tabla de Pedidos -->
  @if (!isLoading() && !error()) {
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
      
      @if (pedidos().length === 0) {
        <div class="p-16 text-center">
           <div class="h-16 w-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4 border border-dashed border-gray-300">
              <svg class="w-8 h-8 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002-2h2a2 2 0 002 2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
           </div>
           <p class="text-gray-900 font-bold text-sm">Sin pedidos recientes</p>
           <p class="text-gray-500 text-xs mt-1">Aún no se han realizado compras.</p>
        </div>
      } @else {
        <div class="overflow-x-auto">
          <table class="w-full text-left border-collapse">
            <thead>
              <tr class="bg-[#f8f9fa] border-b border-gray-200 text-[10px] font-black text-gray-500 uppercase tracking-wider">
                <th class="px-6 py-4">ID / Fecha</th>
                <th class="px-6 py-4">Cliente</th>
                <th class="px-6 py-4">Total</th>
                <th class="px-6 py-4 text-center">Estado Pedido</th>
                <th class="px-6 py-4 text-center">Pago</th>
                <th class="px-6 py-4 text-center">Envío</th>
                <th class="px-6 py-4 text-right">Acciones</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
              
              @for (pedido of pedidos(); track pedido.pedidoId) {
                <tr class="hover:bg-indigo-50/30 transition-colors group">
                  
                  <!-- ID y Fecha -->
                  <td class="px-6 py-4">
                    <div class="flex flex-col">
                      <span class="font-bold text-[#151528] text-sm">#{{ pedido.pedidoId }}</span>
                      <span class="text-[10px] text-gray-400 font-mono mt-0.5">{{ pedido.fecha | date:'dd MMM yyyy HH:mm' }}</span>
                    </div>
                  </td>

                  <!-- Cliente -->
                  <td class="px-6 py-4">
                    <div class="flex items-center gap-2">
                       <div class="h-6 w-6 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center text-[10px] font-bold border border-gray-200">
                          ID
                       </div>
                       <span class="text-xs font-medium text-gray-700">{{ pedido.usuarioId }}</span>
                    </div>
                  </td>

                  <!-- Total -->
                  <td class="px-6 py-4 font-mono text-sm font-bold text-[#151528]">
                    {{ pedido.total | currency:'S/ ' }}
                  </td>

                  <!-- Estado Pedido -->
                  <td class="px-6 py-4 text-center">
                    <select [(ngModel)]="pedido.estado" 
                            (change)="onEstadoPedidoChange(pedido.pedidoId, $event)"
                            class="text-[10px] font-bold uppercase py-1 px-2 rounded-md border-0 focus:ring-2 cursor-pointer transition-all shadow-sm w-32 text-center appearance-none"
                            [ngClass]="{
                              'bg-yellow-100 text-yellow-800 focus:ring-yellow-400': pedido.estado === 'PENDIENTE',
                              'bg-blue-100 text-blue-800 focus:ring-blue-400': pedido.estado === 'PAGADO',
                              'bg-purple-100 text-purple-800 focus:ring-purple-400': pedido.estado === 'ENVIADO',
                              'bg-green-100 text-green-800 focus:ring-green-400': pedido.estado === 'ENTREGADO',
                              'bg-red-100 text-red-800 focus:ring-red-400': pedido.estado === 'CANCELADO'
                            }">
                      @for (estado of estadosPedido; track estado) {
                        <option [value]="estado">{{ estado }}</option>
                      }
                    </select>
                  </td>

                  <!-- Estado Pago -->
                  <td class="px-6 py-4 text-center">
                    <select [(ngModel)]="pedido.estadoPago"
                            (change)="onEstadoPagoChange(pedido.pedidoId, $event)"
                            class="text-[10px] font-bold uppercase py-1 px-2 rounded-md border-0 focus:ring-2 cursor-pointer transition-all shadow-sm w-28 text-center appearance-none"
                            [ngClass]="{
                              'bg-yellow-50 text-yellow-600 border-yellow-200 focus:ring-yellow-300': pedido.estadoPago === 'PENDIENTE',
                              'bg-green-50 text-green-600 border-green-200 focus:ring-green-300': pedido.estadoPago === 'COMPLETADO',
                              'bg-red-50 text-red-600 border-red-200 focus:ring-red-300': pedido.estadoPago === 'FALLIDO'
                            }">
                      @for (estado of estadosPago; track estado) {
                        <option [value]="estado">{{ estado }}</option>
                      }
                    </select>
                  </td>

                  <!-- Estado Envío -->
                  <td class="px-6 py-4 text-center">
                    <select [(ngModel)]="pedido.estadoEnvio"
                            (change)="onEstadoEnvioChange(pedido.pedidoId, $event)"
                            class="text-[10px] font-bold uppercase py-1 px-2 rounded-md border-0 focus:ring-2 cursor-pointer transition-all shadow-sm w-32 text-center appearance-none"
                            [ngClass]="{
                              'bg-gray-100 text-gray-600 focus:ring-gray-300': pedido.estadoEnvio === 'EN_PREPARACION',
                              'bg-sky-100 text-sky-700 focus:ring-sky-300': pedido.estadoEnvio === 'EN_CAMINO',
                              'bg-green-100 text-green-700 focus:ring-green-300': pedido.estadoEnvio === 'ENTREGADO',
                              'bg-orange-100 text-orange-700 focus:ring-orange-300': pedido.estadoEnvio === 'RETRASADO'
                            }">
                      @for (estado of estadosEnvio; track estado) {
                        <option [value]="estado">{{ estado.replace('_', ' ') }}</option>
                      }
                    </select>
                  </td>

                  <!-- Acciones -->
                  <td class="px-6 py-4 text-right">
                    <button class="text-xs font-bold text-indigo-600 hover:text-indigo-900 hover:underline transition-colors flex items-center justify-end gap-1 ml-auto">
                       <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                       Ver Detalles
                    </button>
                    <!-- Aquí iría el modal de detalles (oculto por ahora) -->
                  </td>

                </tr>
              }
              
            </tbody>
          </table>
        </div>
      }
    </div>
  }
</div>