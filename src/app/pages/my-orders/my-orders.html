<div class="container mx-auto p-4 sm:p-8">
  <h1 class="text-3xl font-bold mb-6 text-gray-900">Mis Pedidos</h1>

  <!-- 1. Estado de Carga -->
  <div *ngIf="isLoading()" class="text-center p-12">
    <p class="text-lg text-gray-700">Cargando tus pedidos...</p>
    <!-- (Puedes poner un spinner aqu칤) -->
  </div>

  <!-- 2. Estado de Error -->
  <div *ngIf="error() && !isLoading()" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg">
    <strong>Error:</strong> {{ error() }}
  </div>

  <!-- 3. Contenido Principal (si no est치 cargando y no hay error) -->
  <div *ngIf="!isLoading() && !error()">

    <!-- 3a. Estado Vac칤o (si no hay pedidos) -->
    <div *ngIf="pedidos().length === 0; else hasOrders" class="text-center bg-white p-12 rounded-lg shadow-lg">
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">No has realizado ning칰n pedido</h2>
      <p class="text-gray-600 mb-6">Todos tus pedidos aparecer치n aqu칤.</p>
      <a routerLink="/" class="px-6 py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition duration-300">
        Ir al Cat치logo
      </a>
    </div>

    <!-- 3b. Lista de Pedidos -->
    <ng-template #hasOrders>
      <div class="space-y-6">
        
        <!-- Inicio del Loop -->
        <div *ngFor="let pedido of pedidos()" class="bg-white rounded-lg shadow-lg overflow-hidden transition-shadow duration-300 hover:shadow-xl">
          
          <!-- Encabezado del Pedido -->
          <div class="bg-gray-50 p-4 border-b border-gray-200 grid grid-cols-2 sm:grid-cols-4 gap-4 items-center">
            <div>
              <span class="text-xs font-semibold text-gray-500 uppercase">Pedido ID</span>
              <span class="block text-sm font-medium text-gray-900">#{{ pedido.pedidoId }}</span>
            </div>
            <div>
              <span class="text-xs font-semibold text-gray-500 uppercase">Fecha</span>
              <span class="block text-sm font-medium text-gray-900">{{ pedido.fecha | date:'dd/MM/yyyy' }}</span>
            </div>
            <div>
              <span class="text-xs font-semibold text-gray-500 uppercase">Total</span>
              <span class="block text-xl font-bold text-indigo-600">{{ pedido.total | currency:'S/ ' }}</span>
            </div>
            <div class="text-right">
              <!-- (Opcional) Link a la p치gina de detalle del pedido -->
              <!-- <a [routerLink]="['/pedido', pedido.pedidoId]" class="text-indigo-600 hover:underline text-sm font-medium">Ver Detalles</a> -->
            </div>
          </div>

          <!-- Detalles de Estado -->
          <div class="p-4 grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div>
              <span class="text-xs font-semibold text-gray-500 uppercase">Estado General</span>
              <span class="block text-sm font-medium px-2 py-1 rounded-full text-center w-fit" [ngClass]="getStatusColor(pedido.estado)">
                {{ pedido.estado }}
              </span>
            </div>
            <div>
              <span class="text-xs font-semibold text-gray-500 uppercase">Estado del Pago</span>
              <span class="block text-sm font-medium" [ngClass]="{'text-green-600': pedido.estadoPago === 'Completado', 'text-red-600': pedido.estadoPago === 'Fallido'}">
                {{ pedido.estadoPago }}
              </span>
            </div>
            <div>
              <span class="text-xs font-semibold text-gray-500 uppercase">Estado del Env칤o</span>
              <span class="block text-sm font-medium text-gray-800">
                {{ pedido.estadoEnvio }}
              </span>
            </div>
          </div>
                    <!-- 游댯 L칤nea de tiempo simple -->
          <div class="px-4 pb-4">
            <h3 class="text-sm font-semibold text-gray-700 mb-3">
              Seguimiento del pedido
            </h3>

            <div class="flex items-center justify-between gap-2">

              <!-- Paso 1 -->
              <div class="flex flex-col items-center flex-1">
                <div [ngClass]="getStepClasses(pedido.estadoEnvio, 1)">
                  1
                </div>
                <span class="text-xs font-semibold text-gray-700 mt-1">
                  Registrado
                </span>
              </div>

              <!-- L칤nea entre pasos -->
              <div class="h-0.5 flex-1 bg-gray-200"></div>

              <!-- Paso 2 -->
              <div class="flex flex-col items-center flex-1">
                <div [ngClass]="getStepClasses(pedido.estadoEnvio, 2)">
                  2
                </div>
                <span class="text-xs font-semibold text-gray-700 mt-1">
                  En preparaci칩n
                </span>
              </div>

              <!-- L칤nea entre pasos -->
              <div class="h-0.5 flex-1 bg-gray-200"></div>

              <!-- Paso 3 -->
              <div class="flex flex-col items-center flex-1">
                <div [ngClass]="getStepClasses(pedido.estadoEnvio, 3)">
                  3
                </div>
                <span class="text-xs font-semibold text-gray-700 mt-1 text-center">
                  Listo para recoger
                </span>
              </div>

            </div>
          </div>


          <!-- (Opcional) Resumen de productos en el pedido -->
          <div class="p-4 border-t border-gray-100">
            <span class="text-sm font-medium text-gray-700">Resumen:</span>
            <ul class="list-disc list-inside pl-2 mt-2 text-sm text-gray-600">
              <li *ngFor="let item of pedido.detalles">
                {{ item.cantidad }}x {{ item.productoNombre }}
              </li>
            </ul>
          </div>

        </div>
        <!-- Fin del Loop -->

      </div>
    </ng-template>
  </div>
</div>