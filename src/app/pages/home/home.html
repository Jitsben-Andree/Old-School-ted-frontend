<div class="container mx-auto p-4 sm:p-8">
  <h1 class="text-4xl font-extrabold mb-8 text-center text-gray-900">Catálogo de Camisetas Retro</h1>

  <!-- 1. Estado de Carga -->
  @if (isLoading()) {
    <div class="text-center p-12">
      <p class="text-xl text-gray-700 animate-pulse">Cargando productos...</p>
    </div>
  }

  <!-- 2. Estado de Error -->
  @if (error() && !isLoading()) {
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6 max-w-2xl mx-auto">
      <strong>Error:</strong> {{ error() }}
    </div>
  }

  <!-- 3. Contenedor de Productos (Grid) -->
  @if (!isLoading() && !error()) {
    @if (products().length > 0) {
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 lg:gap-8">
        <!-- Loop de Productos - Usamos @for -->
        @for (prod of products(); track prod.id) {
          <div class="bg-white rounded-xl shadow-lg overflow-hidden flex flex-col transition duration-300 hover:shadow-2xl hover:scale-105 group">

            <!-- Imagen del Producto -->
            <div class="relative">
              <img [src]="prod.imageUrl || 'https://placehold.co/400x400/4c4180/ffffff?text=OS+Tee'"
                   [alt]="prod.nombre"
                   class="w-full h-56 object-cover">
              <!-- Badge de Promoción (si aplica) -->
              @if (prod.nombrePromocion) {
                <span class="absolute top-2 right-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-full shadow">
                  ¡OFERTA!
                </span>
              }
            </div>

            <!-- Contenido de la Tarjeta -->
            <div class="p-4 flex flex-col flex-grow">
              <h2 class="text-lg font-bold text-gray-900 truncate mb-1 group-hover:text-indigo-600" title="{{prod.nombre}}">{{ prod.nombre }}</h2>
              <p class="text-sm text-gray-600 mb-2 line-clamp-2">{{ prod.descripcion || 'Sin descripción' }}</p>

              <!-- Sección de Precios -->
              <div class="flex flex-col mt-auto pt-2">
                <div class="flex justify-between items-baseline mb-1">
                  <!-- Precio Final (con descuento si aplica) -->
                  <span class="text-2xl font-extrabold text-indigo-700">{{ prod.precio | currency:'S/ ' }}</span>
                  <!-- Precio Original (tachado, si hay descuento) -->
                  @if (prod.precioOriginal && prod.precioOriginal !== prod.precio) {
                    <span class="text-sm text-gray-500 line-through ml-2">
                      {{ prod.precioOriginal | currency:'S/ ' }}
                    </span>
                  }
                </div>
                <!-- Indicador de Stock -->
                <span class="text-xs font-medium px-2 py-0.5 rounded self-end"
                      [ngClass]="prod.stock > 0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                  {{ prod.stock > 0 ? 'Stock: ' + prod.stock : 'Agotado' }}
                </span>
                <!-- Nombre de la promoción (opcional) -->
                @if (prod.nombrePromocion) {
                  <span class="text-xs text-red-600 font-medium mt-1 text-center">
                    {{ prod.nombrePromocion }}
                  </span>
                }
              </div>

              <!-- Botón Añadir al Carrito -->
              <div class="mt-3">
                <button (click)="onAddToCart(prod.id, prod.nombre)"
                        [disabled]="!authService.isLoggedIn() || prod.stock === 0"
                        class="w-full py-2 px-4 rounded-lg font-semibold transition duration-200 text-sm
                               bg-indigo-600 text-white hover:bg-indigo-700
                               disabled:bg-gray-400 disabled:cursor-not-allowed">
                  {{ prod.stock === 0 ? 'Agotado' : 'Añadir al Carrito' }}
                </button>
                <!-- Mensaje si no está logueado -->
                @if (!authService.isLoggedIn()) {
                  <small class="text-red-600 block text-center mt-1 text-xs">
                    Debes iniciar sesión para comprar
                  </small>
                }
              </div>
            </div>
          </div>
        } <!-- Fin del @for -->
      </div>
    } @else {
      <!-- Mensaje si no hay productos -->
      <div class="text-center text-gray-500 mt-12">
        No se encontraron productos.
      </div>
    } <!-- Fin del @if products().length -->
  } <!-- Fin del @if !isLoading -->
</div>

