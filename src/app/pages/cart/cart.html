<div class="container mx-auto p-4 sm:p-8">
  <h1 class="text-3xl font-bold mb-6 text-gray-900">Mi Carrito</h1>

  <!-- 1. Estado de Carga -->
  <div *ngIf="isLoading" class="text-center">
    <p class="text-lg text-gray-700">Cargando carrito...</p>
    <!-- (Puedes poner un spinner aquí) -->
  </div>

  <!-- 2. Estado de Error -->
  <div *ngIf="error && !isLoading" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg">
    <strong>Error:</strong> {{ error }}
  </div>

  <!-- 3. Carrito Cargado -->
  <ng-container *ngIf="!isLoading && !error">
    
    <!-- 3a. Usamos el signal cart() del servicio -->
    <ng-container *ngIf="cartService.cart() as cart">
      
      <!-- 3b. Carrito NO vacío -->
      <div *ngIf="cart.items.length > 0; else emptyCart" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Lista de Items (Columna Izquierda) -->
        <div class="lg:col-span-2 bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-semibold mb-4">Items ({{ cart.items.length }})</h2>
          <div class="space-y-4">
            
            <!-- Loop de Items -->
            <div *ngFor="let item of cart.items" class="flex items-center space-x-4 border-b pb-4">
              <img src="https://placehold.co/100x100/e2e8f0/334155?text={{item.productoNombre.charAt(0)}}" alt="{{item.productoNombre}}" class="w-20 h-20 rounded-lg object-cover">
              <div class="flex-grow">
                <h3 class="font-semibold text-lg text-gray-800">{{ item.productoNombre }}</h3>
                <p class="text-sm text-gray-600">Precio: $ {{ item.precioUnitario | number:'1.2-2' }}</p>
                <p class="text-sm text-gray-600">Cantidad: {{ item.cantidad }}</p>
              </div>
              <div class="flex flex-col items-end">
                <span class="font-bold text-xl text-gray-900">$ {{ item.subtotal | number:'1.2-2' }}</span>
                <button (click)="onRemoveItem(item.detalleCarritoId)" class="text-red-600 hover:text-red-800 text-sm font-medium mt-1">
                  Quitar
                </button>
              </div>
            </div>
            <!-- Fin del Loop -->

          </div>
        </div>

        <!-- Resumen del Pedido (Columna Derecha) -->
        <div class="lg:col-span-1 bg-white rounded-lg shadow-lg p-6 h-fit sticky top-24">
          <h2 class="text-xl font-semibold mb-4 border-b pb-2">Resumen</h2>
          <div class="space-y-2">
            <div class="flex justify-between">
              <span class="text-gray-600">Subtotal ({{ cart.items.length }} items)</span>
              <span class="font-medium">$ {{ cart.total | number:'1.2-2' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Envío</span>
              <span class="font-medium">Gratis</span> <!-- (Por ahora) -->
            </div>
            <div class="border-t pt-4 mt-4 flex justify-between items-center">
              <span class="text-xl font-bold text-gray-900">Total</span>
              <span class="text-2xl font-bold text-indigo-600">$ {{ cart.total | number:'1.2-2' }}</span>
            </div>
          </div>
          <button (click)="onCheckout()" class="mt-6 w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition duration-300">
            Proceder al Pago
          </button>
        </div>

      </div>

      <!-- 3c. Template para Carrito Vacío -->
      <ng-template #emptyCart>
        <div class="text-center bg-white p-12 rounded-lg shadow-lg">
          <h2 class="text-2xl font-semibold text-gray-800 mb-4">Tu carrito está vacío</h2>
          <p class="text-gray-600 mb-6">Parece que no has añadido ningún producto todavía.</p>
          <a routerLink="/" class="px-6 py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition duration-300">
            Volver al Catálogo
          </a>
        </div>
      </ng-template>

    </ng-container>

  </ng-container>
</div>
